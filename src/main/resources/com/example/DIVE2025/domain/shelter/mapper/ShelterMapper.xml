<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.DIVE2025.domain.shelter.mapper.ShelterMapper">

    <select id="recommendedShelterId" resultType="com.example.DIVE2025.domain.shelter.dto.RecommendResponseDto">
        SELECT id, username, description,
               (    6371 * acos(
                    cos(radians(#{latitude}))
                        * cos(radians(latitude))
                        * cos(radians(longitude) - radians(#{longitude}))
                    + sin(radians(#{latitude})) * sin(radians(latitude))
                )) AS distance,
            CASE WHEN shelter_feature = #{animalCondition} THEN 0 ELSE 1 END AS match_priority
        FROM shelter
        WHERE #{latitude} != latitude
        ORDER BY match_priority ASC, distance ASC
    </select>

</mapper>